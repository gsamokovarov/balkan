<%= render "section", title: "Send Communication" do %>
  <div class="grid grid-cols-2 gap-6">
    <!-- Left: Send Form -->
    <div>
      <%= admin_form @communication, url: admin_event_communications_path do |f| %>
        <%= f.hidden_field :communication_draft_id %>

        <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">
          Sending: <%= @draft&.name || "Communication" %>
        </h3>

        <!-- Recipient Selection -->
        <div class="space-y-4 mb-6">
          <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Select Recipients</h4>

          <%= f.check_box_input :to_subscribers, label: "Newsletter Subscribers" %>
          <%= f.check_box_input :to_event, label: "Ticket Holders" %>
          <%= f.check_box_input :to_speakers, label: "Confirmed Speakers" %>
        </div>

        <%= f.submit "Send Communication" %>
      <% end %>
    </div>

    <!-- Right: Preview -->
    <div>
      <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">Preview</h3>
      <% if @draft %>
        <% preview = @draft.preview %>
        <div class="space-y-4">
          <div>
            <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2">Subject:</h4>
            <p class="text-base font-semibold text-gray-900 dark:text-gray-100"><%= preview[:subject] %></p>
          </div>

          <div>
            <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2">Body:</h4>
            <div class="p-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 max-h-96 overflow-y-auto">
              <%= sanitize preview[:body] %>
            </div>
          </div>

          <p class="text-xs text-gray-500 dark:text-gray-400">
            Preview uses sample data
          </p>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
