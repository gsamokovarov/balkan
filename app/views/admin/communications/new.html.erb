<%= render "section", title: "Send Communication" do %>
  <div class="grid grid-cols-2 gap-6">
    <!-- Left: Send Form -->
    <div>
      <%= admin_form @communication, url: admin_event_communications_path do |f| %>
        <%= f.hidden_field :communication_draft_id %>

        <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">
          Sending: <%= @draft&.name || "Communication" %>
        </h3>

        <!-- Recipient Selection -->
        <div class="space-y-4 mb-6">
          <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Select Recipients</h4>

          <%= f.check_box_input :include_subscribers, label: "Newsletter Subscribers" %>
          <%= f.check_box_input :include_ticket_holders, label: "Ticket Holders" %>
          <%= f.check_box_input :include_speakers, label: "Confirmed Speakers" %>

          <div>
            <%= label_tag "communication_event_ids", "Events", class: "block text-sm font-medium text-gray-700 dark:text-gray-300" %>
            <%= select_tag "communication[event_ids][]",
                options_from_collection_for_select(Event.all.order(start_date: :desc), :id, :name, [@communication.event_id]),
                { multiple: true, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100", size: 5 } %>
            <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
              Hold Cmd/Ctrl to select multiple events
            </p>
          </div>

          <%= f.text_area_input :custom_recipients_text, rows: 4,
              placeholder: "additional@example.com\nother@example.com",
              label: "Custom Recipients (one per line or comma-separated)" %>
        </div>

        <%= f.submit "Send Communication" %>
      <% end %>
    </div>

    <!-- Right: Preview -->
    <div>
      <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">Preview</h3>
      <% if @draft %>
        <% preview = @draft.preview %>
        <div class="space-y-4">
          <div>
            <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2">Subject:</h4>
            <p class="text-base font-semibold text-gray-900 dark:text-gray-100"><%= preview[:subject] %></p>
          </div>

          <div>
            <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2">Body:</h4>
            <div class="p-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 max-h-96 overflow-y-auto">
              <%= sanitize preview[:body] %>
            </div>
          </div>

          <p class="text-xs text-gray-500 dark:text-gray-400">
            Preview uses sample data
          </p>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
