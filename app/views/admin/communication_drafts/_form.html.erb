<%# locals: (draft:) %>

<div class="flex flex-col md:flex-row md:space-x-6">
  <%= admin_form [:admin, draft], html: { class: "sm:max-w-sm flex-1" } do |f| %>
    <%= f.text_input :name, required: true,
        placeholder: "e.g., Welcome Newsletter" %>

    <%= f.select_input :event_id,
        Event.all.order(start_date: :desc).map { [it.name, it.id] },
        { include_blank: "Not event-specific", label: "Event (optional)" } %>

    <%= f.text_input :subject, required: true,
        placeholder: "e.g., Welcome to {{ event_name }}!" %>

    <%= f.text_area_input :content, required: true, rows: 15,
        placeholder: "Use Liquid variables: {{ email }}, {{ event_name }}, {{ year }}, etc." %>

    <%= f.submit %>
  <% end %>

  <div class="w-full sm:w-96">
    <div class="p-4 bg-gray-50 dark:bg-gray-800 rounded-lg text-sm mb-6">
      <p class="font-medium mb-2">Available Liquid Variables:</p>
      <div class="grid grid-cols-2 gap-2 text-gray-600 dark:text-gray-400">
        <code>{{ email }}</code>
        <code>{{ event_name }}</code>
        <code>{{ event_start_date }}</code>
        <code>{{ event_end_date }}</code>
        <code>{{ year }}</code>
      </div>
    </div>

    <% if draft.persisted? %>
      <h2 class="text-lg font-semibold mb-4">Preview</h2>
      <% preview = draft.preview %>
      <div class="space-y-4">
        <div>
          <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2">Subject</h4>
          <p class="text-base font-semibold text-gray-900 dark:text-gray-100"><%= preview[:subject] %></p>
        </div>

        <div>
          <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2">Body</h4>
          <div class="prose p-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 max-h-96 overflow-y-auto">
            <%= sanitize preview[:body] %>
          </div>
        </div>

        <p class="text-xs text-gray-500 dark:text-gray-400">
          Preview uses sample data
        </p>
      </div>
    <% end %>
  </div>
</div>
