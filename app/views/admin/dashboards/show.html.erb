<% title Current.event.name %>

<div class="flex flex-col gap-12">
  <%= render "section", title: "Health" do %>
    <%= render "stats", data: {
      "Attendees" => @orders.reject(&:fully_refunded?).sum { _1.tickets.size },
      "Tickets gross" => format_money(@orders.sum(&:amount)),
      "Refunded amount" => format_money(@orders.sum(&:refunded_amount)),
      "Newsletter subscribers" => Current.event.subscribers.count,
      "Unfinished orders" => Current.event.orders.where("completed_at IS NULL").count,
    } %>
  <% end %>

  <%= render "section", title: "Tickets", description: "Last 15 tickets sold" do %>
    <%= render "admin/tickets/tickets", tickets: @orders.flat_map(&:tickets).last(15) %>
  <% end %>

  <% Current.event.embeddings.each do |embedding| %>
    <%= render "embedding", embedding: %>
  <% end %>

  <% if Current.event.embeddings.none? %>
    <%= render "section", title: "Embeddings" do %>
      <%= render "empty_state" do %>
        <% admin_button(:primary, link: new_admin_event_embedding_path(Current.event)) { "New embedding" } %>
      <% end %>
    <% end %>
  <% end %>
</div>
