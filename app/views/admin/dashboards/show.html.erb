<% title "Dashboard" %>

<div class="flex flex-col gap-12">
  <%= render "section", title: "Statistics", description: "Important metrics for #{@event.name}" do %>
    <%= render "stats", data: {
      "Attendees" => @orders.reject(&:fully_refunded?).sum { _1.tickets.size },
      "Tickets gross" => format_money(@orders.sum(&:amount)),
      "Refunded amount" => format_money(@orders.sum(&:refunded_amount)),
      "Newsletter subscribers" => @event.subscribers.count,
      "Unfinished orders" => @event.orders.where("completed_at IS NULL").count,
    } %>
  <% end %>

  <%= render "section", title: "Orders", description: "A list of all tickets by orders", cta: -> {
    admin_button :primary, link: true, href: report_admin_orders_path, download: true do
      "Export report"
    end
  } do %>
    <%= render "orders", orders: @orders %>
  <% end %>

  <%= render "section", title: "Speaker applications", description: "Deadline: 02-02-2024", cta: -> {
    admin_button :primary, link: true, href: cfp_responses_url do
      "View in Google Sheets"
    end
  } do %>
    <iframe src="<%= cfp_responses_url %>" class="w-full h-[620px] border-2 border-gray-300 rounded-md"></iframe>
  <% end %>
</div>
